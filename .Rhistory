## remove asv_id and asv_sequence
tax_table(laby.prerarefaction) <- tax_table(laby.prerarefaction)[,-1]
## filtering for rank 6
# 1. reshape data based on taxonomic level you are interested in, and select the top N taxa to show in the plot
sgphylo <- laby.prerarefaction %>%
tax_glom(taxrank = "Genus")
## subset phyloseq object to only have 2020-03-dd and no "filed samples"
phylosub=subset_samples(sgphylo, timepoint=="final")
#View(as.data.frame(phyloseq(sample_data(phylosub))))
## extract otu table from phyloseq object
phylootu = otu_table(phylosub)
phylootu = as.data.frame(t(as.matrix(phylootu)))
## extract metadat from phyloseq object
phylometa = phylosub@sam_data
phylometa = as.matrix(phylometa)
phylometa = as.data.frame(phylometa)
## Adaptation of Jane taxa plot code
#Apply proportion normalisation (relative abundance)
x = phylootu/rowSums(phylootu)
#Sort by most abundant to less abundant
x<-x[,order(colSums(x),decreasing=TRUE)]
rowSums(x)
#Extract list of top N = 20 Taxa
N<-15 #or any other number
taxa_list<-colnames(x)[1:N]
#remove "__Unknown__" and add it to others
taxa_list<-taxa_list[!grepl("Unassigned",taxa_list)]
N<-length(taxa_list)
x <- t(x)     #transposing and then sum up whatever is not in your top 15/20 - will have abundance of top 20 and then final columns with others
colSums(x)
xf2020<-data.frame(x[1:N,]) #get most abundant taxa
xf2020 <- as.data.frame(t(xf2020)) #transpose and cast as data frame
xf2020$Others <- colSums(x[(N+1):length(row.names(x)),])
alltaxa <- as.data.frame(unclass(tax_table(phylosub)))
taxa_N <- alltaxa[which(row.names(alltaxa) %in% taxa_list),]
colnames(xf2020)
print(taxa_N)
colnames(xf2020) <- c("Oceanospirillales; Marinomonas", #2
"Alteromonadales; Glaciecola",#4
"Alteromonadales; Colwellia",#16
"Alteromonadales; Pseudoalteromonas",#1
"Betaproteobacteriales; Methylotenera",#38
"Alteromonadales; Shewanella",#26
"Nitrosococcales; Methylophagaceae",#75
"Alteromonadales; Paraglaciecola"  ,#77
"Chitinophagales; Lewinella",#22
"Flavobacteriales; family Flavobacteriaceae",#64
"Alteromonadales; family Alteromonadaceae",#15
"Flavobacteriales; Kordia",#115
"Rhodobacterales; Sulfitobacter"  ,#21
"Flavobacteriales; Polaribacter_2",
"Rhodobacterales; Loktanella"  ,#9
"Others")
nrow(xf2020)
## save genus names as dataframe
gf2020 = as.data.frame(colnames(xf2020))
colnames(gf2020)[1] <- "genus_id"
## create dataframe that you will graph
xf2020$SampleID <- row.names(xf2020)
xf2020$year = phylometa$sampling_year
xf2020$innoculum = phylometa$innoculum
xf2020$removal = phylometa$removal
xf2020_melt = melt.data.frame(xf2020,
id.vars = c("SampleID", "year", "innoculum","removal"),
variable_name = "Taxa", na.rm=TRUE)
## fix facet labels
inoc <-c(Laby="Lz",Water="H2O")
xf2020_melt$innoculum <- as.character(inoc[xf2020_melt$innoculum])
remov <- c(Bleach="Bleach", NoRemoval="No removal")
xf2020_melt$removal <- as.character(remov[xf2020_melt$removal])
## add treatment column
xf2020_melt$treatment = paste(xf2020_melt$removal, "+", xf2020_melt$innoculum)
## order factors
xf2020_melt$treatment <- factor(xf2020_melt$treatment, levels=c("Bleach + Lz", "Bleach + H2O",
"No removal + Lz","No removal + H2O"))
##### PLOT SETUP - FIELD HEALTHY ######
## read in data
laby.prerarefaction = readRDS("laby_field_prerarefaction_phyloseq.rds")
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("phyloseq")
## Thank you to Jane, Emily, and Katy for help
##### WORKSPACE SETUP #####
## load pacakges
library(phyloseq)
install.packages("C:/Users/siobh/Downloads/phyloseq_1.36.0.zip", repos = NULL, type = "win.binary")
library("phyloseq")
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("phyloseq")
if (!requireNamespace("BiocManager", quietly = TRUE, force = TRUE))
install.packages("BiocManager")
BiocManager::install("phyloseq")
install.packages("phyloseq")
source('http://bioconductor.org/biocLite.R')
biocLite('phyloseq')
BiocManager::install("phyloseq", force=TRUE)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("phyloseq")
BiocManager::install("phyloseq", force=TRUE)
install.packages("xfun")
install.packages("xfun")
library(phyloseq)
install.packages("RCurl")
library(phyloseq)
install.packages("RCurl")
install.packages("C:/Users/siobh/OneDrive/Desktop/RCurl_1.98-1.4.tar.gz", repos = NULL, type = "source")
library(phyloseq)
## load packages
library(tidyverse)
setwd("C:/Users/siobh/OneDrive - The University Of British Columbia/Project - Seaweed Seasonality Transects/seaweed_seasonality_2021-09-05/git_GW_seaweed_seasonality_transects")
## read in data
algae = read.csv("GW_seaweed_seasonality_transect_data.csv")
## dot-line plot
ggplot(x=sampling_date, y=distance_along_transect, data=algae)+
geom_point()
## dot-line plot
ggplot(algae, aes(x=sampling_date, y=distance_along_transect))+
geom_point()
## dot-line plot
ggplot(algae, aes(x=sampling_date, y=distance_along_transect))+
geom_point()+
facet_grid(.~transect_id)
## dot-line plot
ggplot(algae, aes(x=sampling_date, y=distance_along_transect))+
geom_point()+
facet_grid(transect_id~.)
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect, y=fucus_distichus_percent.cover, shape=sampling_date))+
geom_point()+
facet_grid(transect_id~.)
library(ggplot2); theme_set(theme_bw()+
theme(panel.grid = element_blank(),
strip.background = element_rect(fill="white"),
axis.text = element_text(size = 12, color="black"),
axis.title = element_text(size=15, color="black")))
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect, y=fucus_distichus_percent.cover, shape=sampling_date))+
geom_point()+
facet_grid(transect_id~.)
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect, y=fucus_distichus_percent.cover,
shape=sampling_date, color=fucus_distichus_percent.cover))+
geom_point()+
facet_grid(transect_id~.)
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect, y=distance_along_transect,
shape=sampling_date, color=fucus_distichus_percent.cover))+
geom_point()+
facet_grid(transect_id~.)
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect, y=fucus_distichus_percent.cover,
shape=sampling_date, color=fucus_distichus_percent.cover))+
geom_point()+
facet_grid(transect_id~.)
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect, y=fucus_distichus_percent.cover,
shape=sampling_date, color=fucus_distichus_percent.cover))+
geom_point(cex=3)+
facet_grid(transect_id~.)
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect, y=fucus_distichus_percent.cover,
shape=sampling_date, color=fucus_distichus_percent.cover))+
geom_point(cex=3)+
facet_grid(transect_id~.)+
scale_color_gradient(low="grey80",high="forestgreen")
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect, y=fucus_distichus_percent.cover,
shape=sampling_date, color=fucus_distichus_percent.cover))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
scale_color_gradient(low="grey80",high="forestgreen")
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect, y=fucus_distichus_percent.cover,
shape=sampling_date, color=fucus_distichus_percent.cover))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
scale_color_gradient(low="grey80",high="grey0")
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect, y=fucus_distichus_percent.cover,
shape=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
scale_color_gradient(low="grey80",high="grey0")
## dot-line plot (ulav)
ggplot(algae, aes(x=distance_along_transect, y=ulva_fenestrata_percent.cover,
shape=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)
## load packages
library(tidyverse)
library(ggplot2); theme_set(theme_bw()+
theme(panel.grid = element_blank(),
strip.background = element_rect(fill="white"),
axis.text = element_text(size = 12, color="black"),
axis.title = element_text(size=15, color="black")))
## set working directory
setwd("C:/Users/siobh/OneDrive - The University Of British Columbia/Project - Seaweed Seasonality Transects/seaweed_seasonality_2021-09-05/git_GW_seaweed_seasonality_transects")
## read in data
algae = read.csv("GW_seaweed_seasonality_transect_data.csv")
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)
## dot-line plot (ulva)
ggplot(algae, aes(x=distance_along_transect, y=ulva_fenestrata_percent.cover,
shape=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)
## dot-line plot (ulva)
ggplot(algae, aes(x=distance_along_transect_m, y=ulva_fenestrata_percent.cover,
shape=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)
## together
ggplot(algae, aes(distance_along_transect_m))+
geom_line(aes(y = fucus_distichus_percent.cover)) +
geom_line(aes(y = ulva_fenestrata_percent.cover))
## together
ggplot(algae, aes(distance_along_transect_m))+
geom_line(aes(y = fucus_distichus_percent.cover, color=sampling_date))+
geom_line(aes(y = ulva_fenestrata_percent.cover))
## load packages
library(tidyverse)
library(ggplot2); theme_set(theme_bw()+
theme(panel.grid = element_blank(),
strip.background = element_rect(fill="white"),
axis.text = element_text(size = 12, color="black"),
axis.title = element_text(size=15, color="black")))
## set working directory
setwd("C:/Users/siobh/OneDrive - The University Of British Columbia/Project - Seaweed Seasonality Transects/seaweed_seasonality_2021-09-05/git_GW_seaweed_seasonality_transects")
## read in data
algae = read.csv("GW_seaweed_seasonality_transect_data1.csv")
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)
## dot-line plot (ulva)
ggplot(algae, aes(x=distance_along_transect_m, y=ulva_fenestrata_percent.cover,
shape=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)
## dot-line plot (ulva)
ggplot(algae, aes(x=distance_along_transect_m, y=mastocarpus_sp_percent.cover,
shape=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)
## heatmap plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover))+
geom_tile()+
facet_grid(transect_id~.)
## load packages
library(tidyverse)
library(ggplot2); theme_set(theme_bw()+
theme(panel.grid = element_blank(),
strip.background = element_rect(fill="white"),
axis.text = element_text(size = 12, color="black"),
axis.title = element_text(size=15, color="black")))
## set working directory
setwd("C:/Users/siobh/OneDrive - The University Of British Columbia/Project - Seaweed Seasonality Transects/seaweed_seasonality_2021-09-05/git_GW_seaweed_seasonality_transects")
## read in data
algae = read.csv("GW_seaweed_seasonality_transect_data1.csv")
## heatmap plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover))+
geom_tile()+
facet_grid(transect_id~.)
## heatmap plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
fill=value))+
geom_tile()+
facet_grid(transect_id~.)
## heatmap plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
fill=fucus_distichus_percent.cover))+
geom_tile()+
facet_grid(transect_id~.)
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")
## dot-line plot (ulva)
ggplot(algae, aes(x=distance_along_transect_m, y=ulva_fenestrata_percent.cover,
shape=sampling_date, color=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date, , color=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")
View(algae)
## read in data
algae = read.csv("GW_seaweed_seasonality_transect_data1.csv")
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date, color=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c())
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date, color=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date, color=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c("forestgreen","aquamarine2","cyan"))
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date, color=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c("forestgreen","aquamarine4","cyan"))
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date, color=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c("forestgreen","aquamarine1","cyan3"))
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date, color=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c("forestgreen","cyan3","aquamarine3"))
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date, color=sampling_date))+
geom_point(cex=3)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c("forestgreen","dodgerblue","cyan3"))
## dot-line plot (fucus)
ggplot(algae, aes(x=distance_along_transect_m, y=fucus_distichus_percent.cover,
shape=sampling_date, color=sampling_date))+
geom_point(cex=4)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c("forestgreen","dodgerblue","cyan3"))
## group the data by aquariums and sampling date
algae_grouped = ddply(aquarium, c("sampling_date"),
summarise,
N.spad = length(fucus_distichus_percent.cover), ## sample size
mean.spad = mean(fucus_distichus_percent.cover), ## mean
sd.spad = sd(fucus_distichus_percent.cover)## standard deviation
)%>% ## standard deviation)
mutate(se.spad = sd.spad/sqrt(N.spad), ## standard error
lci.spad = mean.spad - 1.960*(se.spad), ## lower bound of 95% confidence interval
uci.spad = mean.spad + 1.960*(se.spad)) ## upper bound of 95% confidence interval
##### WORKSPACE SETUP #####
library(tidyverse)
## load packages
library(tidyverse)
## group the data by aquariums and sampling date
algae_grouped = ddply(aquarium, c("sampling_date"),
summarise,
N.spad = length(fucus_distichus_percent.cover), ## sample size
mean.spad = mean(fucus_distichus_percent.cover), ## mean
sd.spad = sd(fucus_distichus_percent.cover)## standard deviation
)%>% ## standard deviation)
mutate(se.spad = sd.spad/sqrt(N.spad), ## standard error
lci.spad = mean.spad - 1.960*(se.spad), ## lower bound of 95% confidence interval
uci.spad = mean.spad + 1.960*(se.spad)) ## upper bound of 95% confidence interval
library(ddply)
install.packages(ddply)
library(plyry)
library(plyr)
## group the data by aquariums and sampling date
algae_grouped = ddply(aquarium, c("sampling_date"),
summarise,
N.spad = length(fucus_distichus_percent.cover), ## sample size
mean.spad = mean(fucus_distichus_percent.cover), ## mean
sd.spad = sd(fucus_distichus_percent.cover)## standard deviation
)%>% ## standard deviation)
mutate(se.spad = sd.spad/sqrt(N.spad), ## standard error
lci.spad = mean.spad - 1.960*(se.spad), ## lower bound of 95% confidence interval
uci.spad = mean.spad + 1.960*(se.spad)) ## upper bound of 95% confidence interval
## group the data by aquariums and sampling date
algae_grouped = ddply(algae, c("sampling_date"),
summarise,
N.spad = length(fucus_distichus_percent.cover), ## sample size
mean.spad = mean(fucus_distichus_percent.cover), ## mean
sd.spad = sd(fucus_distichus_percent.cover)## standard deviation
)%>% ## standard deviation)
mutate(se.spad = sd.spad/sqrt(N.spad), ## standard error
lci.spad = mean.spad - 1.960*(se.spad), ## lower bound of 95% confidence interval
uci.spad = mean.spad + 1.960*(se.spad)) ## upper bound of 95% confidence interval
## group the data by aquariums and sampling date
algae_grouped = ddply(algae, c("sampling_date", "distance_along_transect_m"),
summarise,
N.spad = length(fucus_distichus_percent.cover), ## sample size
mean.spad = mean(fucus_distichus_percent.cover), ## mean
sd.spad = sd(fucus_distichus_percent.cover)## standard deviation
)%>% ## standard deviation)
mutate(se.spad = sd.spad/sqrt(N.spad), ## standard error
lci.spad = mean.spad - 1.960*(se.spad), ## lower bound of 95% confidence interval
uci.spad = mean.spad + 1.960*(se.spad)) ## upper bound of 95% confidence interval
## dot-line plot (fucus)
ggplot(algae_grouped, aes(x=distance_along_transect_m, y=mean.spad,
shape=sampling_date, color=sampling_date))+
geom_point(cex=4)+
geom_line()+
facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c("forestgreen","dodgerblue","cyan3"))
## dot-line plot (fucus)
ggplot(algae_grouped, aes(x=distance_along_transect_m, y=mean.spad,
shape=sampling_date, color=sampling_date))+
geom_point(cex=4)+
geom_line()+
# facet_grid(transect_id~.)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c("forestgreen","dodgerblue","cyan3"))
## group the data by aquariums and sampling date
algae_grouped = ddply(algae, c("sampling_date", "distance_along_transect_m"),
summarise,
N.fd = length(fucus_distichus_percent.cover), ## sample size
mean.fd = mean(fucus_distichus_percent.cover), ## mean
sd.fd = sd(fucus_distichus_percent.cover)## standard deviation
)%>% ## standard deviation)
mutate(se.fd = sd.fd/sqrt(N.fd), ## standard error
lci.fd = mean.fd - 1.960*(se.fd), ## lower bound of 95% confidence interval
uci.fd = mean.fd + 1.960*(se.fd)) ## upper bound of 95% confidence interval
## dot-line plot (fucus)
ggplot(algae_grouped, aes(x=distance_along_transect_m, y=mean.fd,
shape=sampling_date, color=sampling_date))+
geom_point(cex=4)+
geom_line()+
geom_errorbar(aes(ymin=lci.fd, ymax=uci.fd),
width=0.5)
## dot-line plot (fucus)
ggplot(algae_grouped, aes(x=distance_along_transect_m, y=mean.fd,
shape=sampling_date, color=sampling_date))+
geom_point(cex=4)+
geom_line()+
geom_errorbar(aes(ymin=lci.fd, ymax=uci.fd),
width=0.5)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c("forestgreen","dodgerblue","cyan3"))
library(ggplot2)+theme_set(theme_bw()+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
legend.key=element_blank()))
## dot-line plot (fucus)
ggplot(algae_grouped, aes(x=distance_along_transect_m, y=mean.fd,
shape=sampling_date, color=sampling_date))+
geom_point(cex=4)+
geom_line()+
geom_errorbar(aes(ymin=lci.fd, ymax=uci.fd),
width=0.5)+
xlab("Distance from seawall (m)")+
ylab("Fucus distichus % cover")+
scale_color_manual(values=c("forestgreen","dodgerblue","cyan3"))
